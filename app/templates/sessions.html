<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestión de Rutinas y Sesiones</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // --- JS: manejar dinámicamente sesiones y ejercicios ---
    function addSession() {
      const container = document.getElementById("sessions-container");
      const index = container.children.length;

      const sessionCard = document.createElement("div");
      sessionCard.className = "bg-white shadow-md rounded-xl p-4 mb-4";

      sessionCard.innerHTML = `
        <label class="block mb-2 text-sm font-medium">Nombre de sesión</label>
        <input type="text" name="sessions[${index}][name]" class="w-full border rounded p-2 mb-3" required>

        <div id="exercises-${index}" class="space-y-2 mb-3"></div>

        <button type="button"
                class="bg-blue-500 text-white px-3 py-1 rounded"
                onclick="addExercise(${index})">
          + Agregar ejercicio
        </button>
      `;
      container.appendChild(sessionCard);
    }

    function addExercise(sessionIndex) {
      const container = document.getElementById(`exercises-${sessionIndex}`);
      const exerciseIndex = container.children.length;

      const row = document.createElement("div");
      row.className = "flex space-x-2";

      row.innerHTML = `
        <input type="text"
               name="sessions[${sessionIndex}][exercises][${exerciseIndex}][name]"
               placeholder="Nombre del ejercicio"
               class="border rounded p-1 flex-1" required>
        <input type="number"
               name="sessions[${sessionIndex}][exercises][${exerciseIndex}][sets]"
               placeholder="Series" class="border rounded p-1 w-20" min="1">
        <input type="number"
               name="sessions[${sessionIndex}][exercises][${exerciseIndex}][reps]"
               placeholder="Reps" class="border rounded p-1 w-20" min="1">
      `;
      container.appendChild(row);
    }
  </script>
</head>
<body class="bg-gray-100 p-6">
  <h1 class="text-2xl font-bold mb-6">Crear o editar rutina</h1>

  <form method="POST" action="/sessions/save" class="space-y-4">
    <!-- Selección o creación de rutina -->
    <div class="bg-white p-4 rounded-xl shadow">
      <label class="block mb-2 font-medium">Seleccionar rutina existente</label>
      <select name="routine_id" class="border rounded p-2 w-full mb-3">
        <option value="">-- Crear nueva rutina --</option>
        {% for routine in routines %}
          <option value="{{ routine.id }}">{{ routine.name }}</option>
        {% endfor %}
      </select>

      <label class="block mb-2 font-medium">O crear nueva rutina</label>
      <input type="text" name="routine_name" class="w-full border rounded p-2" placeholder="Nombre de rutina">
    </div>

    <!-- Secciones de sesiones -->
    <div id="sessions-container" class="space-y-4 mt-6"></div>

    <button type="button" class="bg-green-500 text-white px-4 py-2 rounded" onclick="addSession()">
      + Agregar sesión
    </button>

    <div class="pt-6">
      <button type="submit" class="bg-blue-600 text-white px-5 py-2 rounded">
        Guardar rutina
      </button>
    </div>
  </form>
</body>
</html>